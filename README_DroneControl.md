# 无人机手势控制系统使用指南

## 系统概述

本系统实现了基于MediaPipe的实时手势识别，并将识别结果转换为无人机控制指令，支持多种飞行操作的手势控制。

## 环境要求

### 硬件要求
- CPU: Intel i5以上或同等性能AMD处理器
- 内存: 8GB以上
- 摄像头: USB摄像头或笔记本内置摄像头
- 无人机: 支持MAVLink协议的无人机(如PX4/ArduPilot系统)

### 软件要求
- Python 3.8+
- Windows 10/11 或 Ubuntu 18.04+
- 无人机飞控固件支持MAVLink协议

## 安装步骤

### 1. 安装Python依赖
```bash
cd code_ws
pip install -r requirements.txt
```

### 2. 安装可选依赖(用于真实无人机连接)
```bash
# 对于真实无人机控制
pip install pymavlink
pip install pyserial

# 对于高级功能
pip install fastapi uvicorn websockets
```

### 3. 验证安装
```bash
# 测试手势识别
python human_detection_system.py

# 测试无人机接口(模拟模式)
python drone_interface.py
```

## 快速开始

### 1. 启动完整系统
```bash
python main_drone_control.py
```

### 2. 基本操作流程
1. **启动系统**: 运行主程序
2. **连接设备**: 点击"连接"按钮连接无人机
3. **开始检测**: 点击"开始检测"启动手势识别
4. **手势控制**: 对着摄像头做出预定义手势
5. **监控状态**: 观察右侧状态面板的实时信息

### 3. 模拟模式测试
如果没有真实无人机，系统会自动进入模拟模式，可以：
- 测试手势识别功能
- 验证指令生成逻辑
- 熟悉操作界面

## 支持的手势

### 基础飞行手势

| 手势名称 | 手势描述 | 无人机动作 | 示意图 |
|---------|----------|------------|--------|
| 起飞手势 | 双手高举过头 | 起飞到2米高度 | 🙌 |
| 降落手势 | 双手向下压 | 原地降落 | 👇 |
| 前进手势 | 右手前推 | 向前飞行 | 👉 |
| 左移手势 | 左手指向左 | 向左飞行 | 👈 |
| 右移手势 | 右手指向右 | 向右飞行 | 👉 |
| 上升手势 | 双手向上推 | 垂直上升 | ⬆️ |
| 下降手势 | 双手向下压 | 垂直下降 | ⬇️ |
| 停止手势 | 双手胸前交叉 | 悬停 | ❌ |

### 手势识别要点
1. **距离**: 保持在摄像头前1-3米距离
2. **光线**: 确保充足光线，避免逆光
3. **背景**: 简洁背景，减少干扰
4. **持续时间**: 保持手势2-3秒以确保识别
5. **置信度**: 系统置信度>80%才会执行指令

## 系统配置

### 1. 基本设置
- **置信度阈值**: 调整手势识别的敏感度(0.5-1.0)
- **移动速度**: 设置无人机移动的基础速度(0.1-3.0 m/s)
- **自动降落**: 低电量时自动降落功能
- **手势控制**: 启用/禁用手势控制

### 2. 连接配置
- **本地模拟**: `127.0.0.1:14550` (SITL仿真)
- **串口连接**: `COM3` 或 `/dev/ttyUSB0`
- **网络连接**: `192.168.1.100:14550` (WiFi模块)
- **USB连接**: `udp:127.0.0.1:14551`

### 3. 安全参数
```python
# 在drone_interface.py中修改
max_altitude = 10.0        # 最大飞行高度(米)
max_velocity = 5.0         # 最大飞行速度(m/s)
safe_battery_level = 20.0  # 安全电量百分比
```

## 故障排除

### 常见问题

#### 1. 摄像头无法打开
**现象**: 显示"无法打开摄像头"
**解决方案**:
- 检查摄像头是否被其他程序占用
- 确认摄像头驱动正常安装
- 尝试更改摄像头ID (0, 1, 2...)

#### 2. 手势识别不准确
**现象**: 手势无法被正确识别
**解决方案**:
- 调整光线条件，避免强光或阴影
- 保持适当距离(1-3米)
- 降低置信度阈值
- 确保手势标准和持续时间足够

#### 3. 无人机连接失败
**现象**: 显示"无人机连接失败"
**解决方案**:
- 检查连接字符串是否正确
- 确认无人机已开机并建立连接
- 检查防火墙设置
- 验证MAVLink协议配置

#### 4. 指令执行延迟
**现象**: 手势与无人机动作有明显延迟
**解决方案**:
- 检查系统CPU和内存使用率
- 降低视频处理分辨率
- 优化网络连接质量
- 调整指令处理频率

### 日志查看
系统运行日志保存在 `drone_control.log` 文件中，包含：
- 系统启动和关闭信息
- 手势识别结果
- 无人机状态变化
- 错误和异常信息

## 高级功能

### 1. 自定义手势
可以在 `drone_gesture_control.py` 中添加新的手势识别函数：

```python
def detect_custom_gesture(self, landmarks) -> float:
    """自定义手势检测"""
    # 实现自定义手势逻辑
    confidence = 0.0
    # ... 手势检测代码 ...
    return confidence
```

### 2. 扩展控制指令
在 `DroneCommandGenerator` 类中添加新的指令类型：

```python
def generate_custom_command(self, gesture_data):
    """生成自定义控制指令"""
    # 实现自定义指令生成逻辑
    pass
```

### 3. 多无人机控制
系统支持扩展为多无人机控制，需要：
- 修改无人机接口支持多连接
- 实现无人机ID分配和管理
- 添加编队飞行逻辑

## 性能优化

### 1. 提升检测速度
- 使用更快的处理器或GPU
- 降低视频分辨率 (640x480 → 320x240)
- 减少MediaPipe模型复杂度
- 启用多线程处理

### 2. 提升识别精度
- 使用更高质量的摄像头
- 改善光照条件
- 增加训练数据
- 调整识别阈值

### 3. 减少延迟
- 优化网络连接
- 使用有线连接替代WiFi
- 减少指令处理复杂度
- 实现预测性控制

## 安全注意事项

### 1. 飞行前检查
- ✅ 确认飞行区域安全，远离人群和建筑
- ✅ 检查无人机电池电量充足
- ✅ 验证手势识别功能正常
- ✅ 测试紧急停止功能
- ✅ 确认通信链路稳定

### 2. 飞行中监控
- 👀 始终保持视觉监控无人机
- 📱 监控系统状态面板
- 🔋 注意电池电量变化
- 📡 观察通信信号强度
- 🆘 准备随时手动接管

### 3. 紧急处理
- **失控情况**: 立即按下"紧急停止"按钮
- **通信中断**: 无人机会自动悬停或返航
- **低电量**: 系统自动触发降落程序
- **异常行为**: 切换到手动控制模式

## 技术支持

### 文档资源
- MediaPipe文档: https://mediapipe.dev/
- MAVLink协议: https://mavlink.io/
- PX4飞控: https://px4.io/
- ArduPilot: https://ardupilot.org/

### 社区支持
- GitHub Issues: 提交bug报告和功能请求
- 技术论坛: 讨论技术问题和改进建议
- 示例代码: 查看更多应用示例

## 版本更新

### v1.0 (当前版本)
- ✅ 基础手势识别功能
- ✅ MAVLink协议支持
- ✅ GUI控制界面
- ✅ 安全保护机制
- ✅ 模拟测试模式

### 后续版本计划
- 🔄 多无人机协同控制
- 🎯 高精度定位和导航
- 🤖 AI智能路径规划
- 📱 移动端APP控制
- 🌐 云端监控和管理

---

**免责声明**: 本系统仅供学习研究使用，实际飞行请遵守当地法律法规，确保安全飞行。
